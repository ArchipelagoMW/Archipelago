from BaseClasses import Location, Item

misc_items = [
    "50 Silver",
    "Victory",
]

prehardmode_items = [
    "Torch God's Favor",
    "Post-Goblin Army",
    "Post-King Slime",
    "Post-Eye of Cthulhu",
    "Post-Eater of Worlds or Brain of Cthulhu",
    "Post-Old One's Army Tier 1",
    "Post-Queen Bee",
    "Post-Skeletron",
    "Post-Deerclops",
]

calamity_prehardmode_items = [
    "Post-Desert Scourge",
    "Post-Giant Clam",
    "Post-Crabulon",
    "Post-The Hive Mind or The Perforators",
    "Post-The Slime God",
    "Post-Leviathan and Anahita",
    "Post-Colossal Squid",
    "Post-Reaper Shark",
    "Post-Eidolon Wyrm",
]

post_wall_of_flesh_items = [
    "Hardmode",
    "Post-Pirate Invasion",
    "Post-Queen Slime",
    "Post-The Twins",
    "Post-The Destroyer",
    "Post-Skeletron Prime",
    "Post-Old One's Army Tier 2",
    "Post-Duke Fishron",
]

calamity_post_wall_of_flesh_items = [
    "Post-Earth Elemental",
    "Post-Cloud Elemental",
    "Post-Cryogen",
    "Post-Aquatic Scourge",
    "Post-Cragmaw Mire",
    "Post-Brimstone Elemental",
    "Post-Calamitas",
    "Post-Astrum Aureus",
    "Post-Astrum Deus",
    "Post-Adult Eidolon Wyrm",
]

post_plantera_items = [
    "Post-Frost Legion",
    "Post-Plantera",
    "Post-Golem",
    "Post-Old One's Army Tier 3",
    "Post-Martian Madness",
    "Post-Mourning Wood",
    "Post-Pumpking",
    "Post-Everscream",
    "Post-Santa-NK1",
    "Post-Ice Queen",
    "Post-Empress of Light",
    "Post-Lunatic Cultist",
    "Post-Lunar Events",
]

calamity_post_plantera_items = [
    "Post-Armored Digger",
    "Post-Great Sand Shark",
    "Post-Plaguebringer",
    "Post-The Plaguebringer Goliath",
    "Post-Ravager",
    "Post-The Dragonfolly",
    "Post-Jungle Dragon, Yharon",
]

post_moon_lord_items = [
    "Post-Moon Lord"
]

calamity_post_moon_lord_items = [
    "Post-Profaned Guardians",
    "Post-Providence, the Profaned Goddess"
    "Post-Storm Weaver",
    "Post-Ceaseless Void",
    "Post-Signus, Envoy of the Devourer",
    "Post-Polterghast",
    "Post-Mauler",
    "Post-Nuclear Terror",
    "Post-The Old Duke",
    "Post-The Devourer of Gods",
    "Post-Exo Mechs",
    "Post-Supreme Calamitas",
]

item_items = [
    "Hermes Boots",
    "Magic Mirror",
    "Cloud in a Bottle",
    "Grappling Hook",
    "Climbing Claws",
    "Fledgling Wings",
    "Demon Conch",
    "Magic Conch",
    "Anklet of the Wind",
    "Aglet",
    "Ice Skates",
    "Lava Charm",
    "Obsidian Rose",
    "Nature's Gift",
    "Feral Claws",
    "Magma Stone",
    "Shark Tooth Necklace",
    "Cobalt Shield",
    "Band of Regeneration",
    "Philosopher's Stone",
    "Cross Necklace",
    "Magic Quiver",
    "Rifle Scope",
    "Celestial Magnet",
    "Rod of Discord",
    "Flying Carpet",
    "Lifeform Analyzer",
    "Ancient Chisel",
    "Moon Charm",
    "Neptune's Shell",
    "Shoe Spikes",
    "Tabi",
    "Black Belt",
    "Flesh Knuckles",
    "Putrid Scent",
    "Paladin's Shield",
    "Frozen Turtle Shell",
    "Star Cloak",
    "Discount Card",
    "Red Counterweight",
    "Yoyo Glove",
    "Depth Meter",
    "Compass",
    "Radar",
    "DPS Meter",
    "Metal Detector",
    "Sextant",
    "Stopwatch",
    "Tally Counter",
    "Fisherman's Pocket Guide",
    "High Test Fishing Line",
    "Angler Earring",
    "Tackle Box",
    "Lavaproof Fishing Hook",
    "Weather Radio",
    "Blindfold",
    "Pocket Mirror",
    "Vitamins",
    "Armor Polish",
    "Adhesive Bandage",
    "Bezoar",
    "Nazar",
    "Megaphone",
    "Trifold Map",
    "Fast Clock",
    "Brick Layer",
    "Extendo Grip",
    "Paint Sprayer",
    "Portable Cement Mixer",
    "Treasure Magnet",
    "Step Stool",
    "Gold Ring",
    "Lucky Coin",
]

# Debugging utility
precollected = []

prehardmode_locations = [
    "Torch God",
    "Goblin Army",
    "King Slime",
    "Eye of Cthulhu",
    "Eater of Worlds or Brain of Cthulhu",
    "Old One's Army Tier 1",
    "Queen Bee",
    "Skeletron",
    "Deerclops",
    "Wall of Flesh",
]

calamity_prehardmode_locations = [
    "Desert Scourge",
    "Giant Clam",
    "Crabulon",
    "The Hive Mind or The Perforators",
    "The Slime God",
    "Aquatic Scourge",
    "Leviathan and Anahita",
    "Colossal Squid",
    "Reaper Shark",
    "Eidolon Wyrm",
]

post_wall_of_flesh_locations = [
    "Pirate Invasion",
    "Queen Slime",
    "The Twins",
    "The Destroyer",
    "Skeletron Prime",
    "Old One's Army Tier 2",
    "Plantera",
    "Duke Fishron",
]

calamity_post_wall_of_flesh_locations = [
    "Earth Elemental",
    "Cloud Elemental",
    "Cryogen",
    "Cragmaw Mire",
    "Brimstone Elemental",
    "Calamitas",
    "Astrum Aureus",
    "Astrum Deus",
    "Adult Eidolon Wyrm",
]

post_plantera_locations = [
    "Frost Legion",
    "Golem",
    "Old One's Army Tier 3",
    "Martian Madness",
    "Mourning Wood",
    "Pumpking",
    "Everscream",
    "Santa-NK1",
    "Ice Queen",
    "Empress of Light",
    "Lunatic Cultist",
    "Lunar Events",
    "Moon Lord",
]

calamity_post_plantera_locations = [
    "Armored Digger",
    "Great Sand Shark",
    "Plaguebringer",
    "The Plaguebringer Goliath",
    "Ravager",
    "The Dragonfolly",
    "Jungle Dragon, Yharon",
]

post_moon_lord_locations = [
    "Zenith",
]

calamity_post_moon_lord_locations = [
    "Profaned Guardians",
    "Providence, the Profaned Goddess"
    "Storm Weaver",
    "Ceaseless Void",
    "Signus, Envoy of the Devourer",
    "Polterghast",
    "Mauler",
    "Nuclear Terror",
    "The Old Duke",
    "The Devourer of Gods",
    "Exo Mechs",
    "Supreme Calamitas",
]

prehardmode_achievements = [
    "Timber!!",
    "No Hobo",
    "Stop! Hammer Time!",
    "Ooo! Shiny!",
    "Heart Breaker",
    "Heavy Metal",
    "I Am Loot!",
    "Star Power",
    "Hold on Tight!",
    "Smashing, Poppet!",
    "Where's My Honey?",
    "Dungeon Heist",
    "It's Getting Hot in Here",
    "Miner for Fire",
    "Like a Boss",
    "Bloodbath",
    "Not the Bees!",
    "Jeepers Creepers",
    "Funkytown",
    "Into Orbit",
    "Rock Bottom",
    "Fashion Statement",
    "Vehicular Manslaughter",
    "Lucky Break",
    "Throwing Lines",
    "Dye Hard",
    "The Frequent Flyer", # New
    "The Cavalry",
    "Completely Awesome",
    "Til Death...",
    "Watch Your Step!",
    "You Can Do It!",
    "Matching Attire",
    "Benched",
    "Quiet Neighborhood",
    "Hot Reels!",
    "Leading Landlord",
    "Feeling Petty",
]

grindy_prehardmode_achievements = [
    "Sticky Situation",
    "There are Some Who Call Him...",
    "Bulldozer", # New
    "Deceiver of Fools",
    "Archaeologist",
    "Pretty in Pink",
    "Marathon Medalist", # New
    "Boots of the Hero",
    "A Rather Blustery Day",
    "Heliophobia",
    "Jolly Jamboree",
    "Dead Men Tell No Tales",
]

fishing_prehardmode_achievements = [
    "Glorious Golden Pole",
    "Servant-in-Training",
    "10 Fishing Quests", # This achievement was intentionally renamed
    "Trout Monkey",
    "Fast and Fishious",
    "Supreme Helper Minion!",
]

achievements_that_are_fishing_if_prehardmode = [
    "Head in the Clouds",
]

post_wall_of_flesh_achievements = [
    "Begone, Evil!",
    "Extra Shiny!",
    "Buckets of Bolts", # New
    "Drax Attax",
    "Photosynthesis",
    "Get a Life",
    "Kill the Sun",
    "Mecha Mayhem",
    "Prismancer",
    "It Can Talk?!",
]

grindy_post_wall_of_flesh_achievements = [
    "Gelatin World Tour",
    "Topped Off",
    "Don't Dread on Me",
]

post_plantera_achievements = [
    "Temple Raider",
    "Robbing the Grave",
    "Baleful Harvest",
    "Ice Scream",
    "Sword of the Hero",
]

grindy_post_plantera_achievements = [
    "Big Booty",
    "Real Estate Agent",
    "Rainbows and Unicorns",
]

post_moon_lord_achievements = [
    "Sick Throw",
    "You and What Army?",
    "Slayer of Worlds", # New
]

def register(names, name_to_id, next_id):
    for name in names:
        name_to_id[name] = next_id
        next_id += 1
    return next_id

def assign_ids():
    next_id = 0x7E0000

    item_name_to_id: dict[str, int] = {}
    location_name_to_id: dict[str, int] = {}

    next_id = register(misc_items, item_name_to_id, next_id)
    next_id = register(prehardmode_items, item_name_to_id, next_id)
    next_id = register(post_wall_of_flesh_items, item_name_to_id, next_id)
    next_id = register(post_plantera_items, item_name_to_id, next_id)
    next_id = register(post_moon_lord_items, item_name_to_id, next_id)
    next_id = register(item_items, item_name_to_id, next_id)

    next_id = register(prehardmode_locations, location_name_to_id, next_id)
    next_id = register(post_wall_of_flesh_locations, location_name_to_id, next_id)
    next_id = register(post_plantera_locations, location_name_to_id, next_id)
    next_id = register(post_moon_lord_locations, location_name_to_id, next_id)
    next_id = register(prehardmode_achievements, location_name_to_id, next_id)
    next_id = register(grindy_prehardmode_achievements, location_name_to_id, next_id)
    next_id = register(fishing_prehardmode_achievements, location_name_to_id, next_id)
    next_id = register(achievements_that_are_fishing_if_prehardmode, location_name_to_id, next_id)
    next_id = register(post_wall_of_flesh_achievements, location_name_to_id, next_id)
    next_id = register(grindy_post_wall_of_flesh_achievements, location_name_to_id, next_id)
    next_id = register(post_plantera_achievements, location_name_to_id, next_id)
    next_id = register(grindy_post_plantera_achievements, location_name_to_id, next_id)
    next_id = register(post_moon_lord_achievements, location_name_to_id, next_id)

    return item_name_to_id, location_name_to_id

item_name_to_id, location_name_to_id = assign_ids()

class TerrariaItem(Item):
    game = "Terraria"

class TerrariaLocation(Location):
    game = "Terraria"

def get_items_locations(goal, achievements_opt, extra_checks):
    items = prehardmode_items.copy()
    if goal > 0:
        items += post_wall_of_flesh_items
    if goal > 1:
        items += post_plantera_items
    if goal > 2:
        items += post_moon_lord_items

    locations = prehardmode_locations.copy()
    if goal > 0:
        locations += post_wall_of_flesh_locations
    if goal > 1:
        locations += post_plantera_locations
    if goal > 2:
        locations += post_moon_lord_locations
    if achievements_opt > 0:
        locations += prehardmode_achievements
    if achievements_opt > 1:
        locations += grindy_prehardmode_achievements
    if achievements_opt > 2:
        locations += fishing_prehardmode_achievements
    if (goal > 0 and achievements_opt > 0) or achievements_opt > 2:
        locations += achievements_that_are_fishing_if_prehardmode
    if goal > 0 and achievements_opt > 0:
        locations += post_wall_of_flesh_achievements
    if goal > 0 and achievements_opt > 1:
        locations += grindy_post_wall_of_flesh_achievements
    if goal > 1 and achievements_opt > 0:
        locations += post_plantera_achievements
    if goal > 1 and achievements_opt > 1:
        locations += grindy_post_plantera_achievements
    if goal > 2 and achievements_opt > 0:
        locations += post_moon_lord_achievements

    # Subtract one from location counts, since the goal does not need an associated item
    if extra_checks == 1 and len(items) < len(locations) - 1:
        if len(locations) - len(items) - 1 < len(item_items):
            items += item_items[:len(locations) - len(items) - 1]
        else:
            items += item_items

    if len(items) < len(locations) - 1:
        items += ["50 Silver"] * (len(locations) - len(items) - 1)

    return items, locations
